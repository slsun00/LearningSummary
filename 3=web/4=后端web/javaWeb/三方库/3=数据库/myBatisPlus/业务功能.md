



## mybatis-plus



```java
安装 -- maven 引入
注解 -- 看注解模块
    注解关键词
// 核心功能
 
```

## 配置

### mysql

#### mysql5（spring boot 2.0）

```java
#mysql数据库连接
spring.datasource.driver-class-name=com.mysql.jdbc.Driver
spring.datasource.url=jdbc:mysql://localhost:3306/mybatis_plus
spring.datasource.username=root
spring.datasource.password=123456
```

#### mysql8以上（spring boot 2.1）

```java
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql://localhost:3306/mybatis_plus?serverTimezone=GMT%2B8
spring.datasource.username=root
spring.datasource.password=123456
```

#### 区别

```java
1. driver和url的变化
2. url 使用了 ?serverTimezone=GMT%2B8 后缀，
    因为Spring Boot 2.1 集成了 8.0版本的jdbc驱动，这个版本的 jdbc 驱动需要添加这个后缀
    java.sql.SQLException: The server time zone value 'ÖÐ¹ú±ê×¼Ê±¼ä' is unrecognized or represents more 
3.  driver-class-name 使用了  com.mysql.cj.jdbc.Driver 
	 jdbc 8 中 建议使用这个驱动，之前的 com.mysql.jdbc.Driver 已经被废弃，
     否则运行测试用例的时候会有 WARN 信息    
```

### 多数据源

## 代码生成器

### 基础

```java
代码生成器
    1. 使用： 添加依赖 、编写配置
    2. 自定义
    	模板引擎
    	代码模板
    	属性注入
    	字段其他信息查询注入
    

```



### 自动填充

```java
介绍
    项目中经常会遇到一些数据，每次都使用相同的方式填充，例如记录的创建时间，更新时间等。
    以使用MyBatis Plus的自动填充功能，完成这些字段的赋值工作：
语法例子
    
// 实例

// 自定义自动填充接口
@Component
public class MyMetaObjectHandler implements MetaObjectHandler {
    private static final Logger LOGGER = LoggerFactory.getLogger(MyMetaObjectHandler.class);
    @Override
    public void insertFill(MetaObject metaObject) {
        LOGGER.info("start insert fill ....");
        this.setFieldValByName("createTime", new Date(), metaObject);
        this.setFieldValByName("updateTime", new Date(), metaObject);
    }
    @Override
    public void updateFill(MetaObject metaObject) {
        LOGGER.info("start update fill ....");
        this.setFieldValByName("updateTime", new Date(), metaObject);
    }
}

// 使用
@Data
public class User {
    ...... 
    @TableField(fill = FieldFill.INSERT)
    private Date createTime;
    //@TableField(fill = FieldFill.UPDATE)
    @TableField(fill = FieldFill.INSERT_UPDATE)
    private Date updateTime;

}   



```



## CURD接口 

```java
// CURD 接口
service CURD :
	save saveOrUpdate  remove  	update
    get  list  count  chain  
    page
mapper CURD:
	insert 
    delete 
        deleteBatchIds：// 删除（根据ID 批量删除）
        deleteById // 根据 ID 删除
    update
        
    select
      selectBatchIds ： 批量
      selectByMap
      selectMapsPage: 根据 Wrapper 条件(只查需要的)，查询全部记录（并翻页）
        
mapper 层选装件
	 AlwaysUpdateSomeColumnById
	insertBatchSomeColumn
	deleteByIdWithFill        
```

## 条件构造器 

### wrapper

```java
// wrapper 包装..
// 比如把一些现成的东西 自己加些新的功能再用一样..
// 用来构建 sql 的条件语句
Wrapper  条件构造抽象类
    -- AbstractWrapper 查询条件封装，用于生成 sql 中的 where 语句。
        -- QueryWrapper Entity 对象封装操作类，用于查询。
        -- UpdateWrapper Update 条件封装操作类，用于更新。
        -- AbstractLambdaWrapper 使用 Lambda 表达式封装 wrapper
            -- LambdaQueryWrapper 使用 Lambda 语法封装条件，用于查询。
            -- LambdaUpdateWrapper 使用 Lambda 语法封装条件，用于更新。
```

### AbstractWrapper

#### 大小

```java
allEq
eq			==
ne			<>
gt			>
ge			>=
lt			<
le			<=
    
```

#### 范围

```java
between				// 等价于 between a and b,
    not between      // 等价于 not between a and b
in					// 字段 IN (v0, v1, ...)
    not in	
inSql				// 字段 IN (sql 语句)
    not inSql
```

#### 匹配

```java
like
    not like
likeLeft
likeRight    
```

#### 空值

```java
isnull
    isNotNull
```

#### 分组、排序

```java
group
    
orderByAsc
orderByDesc
    
having    
```

#### 拼接

```java
or
and
nested
apply
last
exists
    not exists
```

###  queryWrapper

```java
select
```

### updateWrapper

```java
set
setSql
lambda    
```

### 自定义 sql

```java
注解
xml
Kotlin 使用
链式调用    
```

## id

### sequence 主键

```java
介绍
    序列(SEQUENCE)是序列号生成器，可以为表中的行自动生成序列号，产生一组等间隔的数值(类型为数字)。
    不占用磁盘空间，占用内存。
    其主要用途是生成表的主键值，
    	可以在插入语句中引用，
    	可以通过查询检查当前值，或使序列增至下一个值。

spring-boot
spring    
```

### 自定义 id 生成器

```java
spring-boot
spring    
```

###  主键策略

```java
// 默认 雪花算法
MyBatis-Plus默认的主键策略是：ID_WORKER  全局唯一ID
    // 使用
```

### 自增策略 --  主键

```java
使用
    1. 需要在创建数据表的时候设置主键自增
    2. 实体字段中配置 @TableId(type = IdType.AUTO)
例子
public class User {
    @Table(type=IdType.Auto)
    private Long id;
}   

// 方式二
全局设置主键生成策略
要想影响所有实体的配置，可以设置全局主键配置    
	mybatis-plus.global-config.db-config.id-type = auto
```









## === 通用 ===

## 分页

```java

```



## 乐观锁

```java
// 当要更新一条记录的时候，希望这条记录没有被别人更新
        取出记录时，获取当前version
        更新时，带上这个version
        执行更新时， set version = newVersion where version = oldVersion
        如果version不对，就更新失败
使用
	配置 + version 注解


            
// 基于注解            
@EnableTransactionManagement
@Configuration
@MapperScan("com.atguigu.mybatis_plus.mapper")
public class MybatisPlusConfig {
    /**
     * 乐观锁插件
     */
    @Bean
    public OptimisticLockerInterceptor optimisticLockerInterceptor() {
        return new OptimisticLockerInterceptor();
    }
}



// 实例
public class User{
    @Version
    private Integer version
}
```





## 逻辑删除

```java
介绍
    物理删除： 真是删除， 将对应数据从数据库中删除，之后查询不到这条被删除的数据
    逻辑删除： 假删除， 将对应数据中代表删除的删除字段设置为被删除状态，还是能查得到的
逻辑删除使用场景
    可进行数据恢复
    有关联数据，不便删除
    
案例
    @TableLogic()
```



## === 扩展 ===



## 枚举

```java
jackson
Fastjson    
```

## sql 

### 注入器

### sql 分析打印



## 数据安全保护

## 字段类型处理器

## 快速开发插件

```java
mybatisX 快速开发差劲
```





## === 插件 === 

## 多租户

## 动态表名

## sql性能规范

## 防止全表更新与删除