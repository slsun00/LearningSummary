## 异常管理

```java
抛出异常 
显示异常信息 
    普通请求：在页面上显示异常信息 
    Ajax 请求：返回 JSON 数据
```



## 异常管理类

### 工作流程

```JAVA
前端
    发送请求
    	url:send/array.html            
```



![image-20210506100153306](image-20210506100153306.png)

### 基于注解

```java
// 包: goson
// 位置： component/com../mvc/config    
    
@ControllerAdvice
public class CrowdExceptionResolver {
	
	@ExceptionHandler(value = NullPointerException.class)
	public ModelAndView resolveNullPointerException(
			NullPointerException exception, 
			HttpServletRequest request,
			HttpServletResponse response) throws IOException {
		
		String viewName = "system-error";
				
		// 返回
		return commonResolve(viewName, exception, request, response);
	}
	
	private ModelAndView commonResolve(
			String viewName,
			Exception exception,
			HttpServletRequest request,
			HttpServletResponse response) throws IOException {
		
		
		// 判断请求类型
		boolean judgeResult = CrowdUtil.judgeRequestType(request);
		
		// ajax 请求
		if (judgeResult) {
			// 创建 resultEntity
			ResultEntity<Object> resultEntity = ResultEntity.failed(exception.getMessage());
			// 转为 json
			Gson gson = new Gson();
			String json = gson.toJson(resultEntity);
			
			// json 字符串返回给浏览器
			response.getWriter().write(json);
			
			// 通过原生 response 返回响应， 所以不用提供 modelandview 对象
			return null;								
		}
		
		// 不是 ajax 对象 ，则创建  modelandview
		ModelAndView modelAndView = new ModelAndView();
		
		// 将 exception 对象存入模型
		modelAndView.addObject(CrowdConstant.ATTR_NAME_EXCEPTION, exception);
		
		// 设置对应的视图名称
		modelAndView.setViewName(viewName);
		
		return modelAndView;
	}
}  
```

