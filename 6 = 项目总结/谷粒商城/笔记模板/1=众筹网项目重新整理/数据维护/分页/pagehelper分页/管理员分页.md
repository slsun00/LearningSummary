##  == 分页 ==

## 后端

### 坐标依赖

```xml
// 引入依赖
<dependency>
    <groupId>com.github.pagehelper</groupId>
    <artifactId>pagehelper</artifactId>
</dependency>
```



### 依赖配置

```xml
   
// spring-persist-mybatis.xml  配置插件
		<!-- 配置插件 -->
		<property name="plugins">
			<array>
				<!-- 配置PageHelper插件 -->
				<bean class="com.github.pagehelper.PageHelper">
					<property name="properties">
						<props>
							<!-- 配置数据库方言，告诉PageHelper当前使用的数据库 -->
                               <!-- 这个是固定值 -->
							<prop key="dialect">mysql</prop>
							
							<!-- 配置页码的合理化修正，在1~总页数之间修正页码 -->
							<prop key="reasonable">true</prop>
						</props>
					</property>
				</bean>
			</array>
		</property>
```



### == 模板整理 == 

### mapper.xml

```java
adminMapper.xml
    
<select id="selectAdminListByKeyword" resultMap="BaseResultMap">
select
<include refid="Base_Column_List" />
from t_admin
where 
    login_acct like CONCAT("%",#{keyword},"%")
     or
     user_name like CONCAT("%",#{keyword},"%")
     or
     email like CONCAT("%",#{keyword},"%")
    <!-- 只要有一个符合自己查询的条件，就找出来  elasticSearch-->
</select>
```



### mapper

```java
    List<Admin> selectAdminListByKeyword(String keyword);
```



### service

```java
	@Override
	public PageInfo<Admin> getPageInfo(String keyword, Integer pageNum, Integer pageSize) {
		
		// 1.调用PageHelper的静态方法开启分页功能
		// 这里充分体现了PageHelper的“非侵入式”设计：原本要做的查询不必有任何修改
		PageHelper.startPage(pageNum, pageSize);
		
		// 2.执行查询
		List<Admin> list = adminMapper.selectAdminByKeyword(keyword);
		
		// 3.封装到PageInfo对象中
        // 记得看一下 pageInfo 的源码
		return new PageInfo<>(list);
	}

```



### controller

```java
	@RequestMapping("/admin/get/page.html")
	public String getPageInfo(
				
				// 使用@RequestParam注解的defaultValue属性，
        		// 指定默认值，在请求中没有携带对应参数时使用默认值
				// keyword默认值使用空字符串，和SQL语句配合实现两种情况适配
				@RequestParam(value="keyword", defaultValue="") String keyword,
				
				// pageNum默认值使用1
				@RequestParam(value="pageNum", defaultValue="1") Integer pageNum,
				
				// pageSize默认值使用5
				@RequestParam(value="pageSize", defaultValue="5") Integer pageSize,
				
				ModelMap modelMap
			
			) {
		
		// 调用Service方法获取PageInfo对象
		PageInfo<Admin> pageInfo = adminService.getPageInfo(keyword, pageNum, pageSize);
		
		// 将PageInfo对象存入模型
		modelMap.addAttribute(CrowdConstant.ATTR_NAME_PAGE_INFO, pageInfo);
		
		return "admin-page";
	}
```



## 前端

### 侧边栏

```java
这个就是侧边栏有一个超链接，可以想后端发起请求，可以达到想后端进行请求的效果
一点击前端侧边栏的响应标签，就可以实现具体的请求， 实现查询
    
    <li style="height: 30px;">
        <a href="admin/get/page.html">
       		 <i class="glyphicon glyphicon-user"></i> 用户维护
        </a>
     </li>    
```

### 数据展示

```jsp
<tbody>
	<c:if test="${empty requestScope.pageInfo.list }">
		<tr>
			<td colspan="6" align="center">抱歉！没有查询到您要的数据！</td>
		</tr>
	</c:if>
	
    <!--
		controller 进行视图转发的时候，
		在 requestScope 域中保存的有数据： pageInfo
		PageInfo 中放的就是查询数据
		{
                pageInfo {   这个是存入的数据
                    list: [] 
                }
		}
		
	-->
	<c:if test="${!empty requestScope.pageInfo.list }">
		<c:forEach items="${requestScope.pageInfo.list }" var="admin" varStatus="myStatus">
			<tr>
				<td>${myStatus.count }</td>
				<td><input type="checkbox"></td>
				<td>${admin.loginAcct }</td>
				<td>${admin.userName }</td>
				<td>${admin.email }</td>
			</tr>
		</c:forEach>
	</c:if>
</tbody>
    
    
    <tfoot>
        <tr>
            <td colspan="6" align="center">
                <div id="Pagination" class="pagination"><!-- 这里显示分页 --></div>
            </td>
        </tr>
    </tfoot>    
```



##  == 分页导航条 == 

## 前端

### 分页导航条插件

```java
使用
     Pagination 插件环境
    解压 pagination_zh.zip 包，放到
    	
    webapp
    	css
    		pagination.css
    	jquery
    		jquery.pagination.js
    
引入
     <link rel="stylesheet" href="css/pagination.css">
	<script type="text/javascript" src="jquery/jquery.pagination.js"></script>
        
```

### js 代码

```js
$(function(){
    // 调用专门的函数初始化分页导航条
    initPagination();
});
// 声明一个函数用于初始化 Pagination
function initPagination() {
	// 获取分页数据中的总记录数
	var totalRecord = ${requestScope.pageInfo.total};
	// 声明 Pagination 设置属性的 JSON 对象
	var properties = {
        num_edge_entries: 3, // 边缘页数
        num_display_entries: 5, // 主体页数
        callback: pageSelectCallback, // 用户点击“翻页”按钮之后执行翻页操作的回调函数
        current_page: ${requestScope.pageInfo.pageNum-1},  
        		// 当前页，pageNum 从 1 开始，必须-1 后才可以赋值
        prev_text: "上一页",
        next_text: "下一页",
    	items_per_page:${requestScope.pageInfo.pageSize} // 每页显示 1 项
    };

    // 调用分页导航条对应的 jQuery 对象的 pagination()方法生成导航条
    $("#Pagination").pagination(totalRecord, properties);
}

    // 翻页过程中执行的回调函数
    // 点击“上一页”、“下一页”或“数字页码”都会触发翻页动作，从而导致当前函数被调用
    // pageIndex 是用户在页面上点击的页码数值
    function pageSelectCallback(pageIndex, jQuery) {
        // pageIndex 是当前页页码的索引，相对于 pageNum 来说，pageIndex 比 pageNum 小 1
        var pageNum = pageIndex + 1;
        
        // 执行页面跳转也就是实现“翻页”
        window.location.href = "admin/page.html?pageNum="+pageNum;
        // 取消当前超链接的默认行为
        return false;
    }    
```

### html 替换

```java
<tfoot>
	<tr>
		<td colspan="6" align="center">
			<div id="Pagination" class="pagination">显示分页</div>
		</td>
	</tr>

</tfoot>
```

## == 增 ==

## 新增

### 前端

#### 跳出的表单页面

```html

<!--
	这个是主要的表单，其他的不重要就没写进来
-->
<div class="panel-body">
	<form action="admin/save.html" method="post" role="form">
		<p>${requestScope.exception.message }</p>
		<div class="form-group">
			<label for="exampleInputPassword1">登录账号</label>
			<input
				name="loginAcct"
				type="text" class="form-control" id="exampleInputPassword1"
				placeholder="请输入登录账号">
		</div>
		<!--
		密码、邮箱等信息，都是按照账号登陆的样式来的
		-->		                    
		<button type="submit" class="btn btn-success">
			<i class="glyphicon glyphicon-plus"></i> 新增
		</button>
		<button type="reset" class="btn btn-danger">
			<i class="glyphicon glyphicon-refresh"></i> 重置
		</button>
	</form>
</div>
```

#### 点击页面

```java
//    
<a href="admin/to/add/page.html"
    class="btn btn-primary" style="float: right;"><i class="glyphicon glyphicon-plus"></i> 新增</a>
```



#### 分页保持

```java
<mvc:view-controller path="/admin/to/add/page.html" view-name="admin-add"/>
```



### 后端

#### controller

```java
	@RequestMapping("/admin/save.html")
	public String save(Admin admin) {
		
		adminService.saveAdmin(admin);
		
         // 重定向到分页页面，使用重定向是为了避免刷新浏览器重复提交表单
        // 加最大值，是为了正好显示到添加的最后一页
		return "redirect:/admin/get/page.html?pageNum="+Integer.MAX_VALUE;
	}
```



#### service

```java
public void saveAdmin(Admin admin) {

    // 1.密码加密
    String userPswd = admin.getUserPswd();
    userPswd = CrowdUtil.md5(userPswd);
    admin.setUserPswd(userPswd);

    // 2.生成创建时间
    Date date = new Date();
    SimpleDateFormat format = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
    String createTime = format.format(date);
    admin.setCreateTime(createTime);

    // 3.执行保存
    try {
        adminMapper.insert(admin);
    } catch (Exception e) {
        e.printStackTrace();

        logger.info("异常全类名="+e.getClass().getName());

        if(e instanceof DuplicateKeyException) {
            throw new LoginAcctAlreadyInUseException(CrowdConstant.MESSAGE_LOGIN_ACCT_ALREADY_IN_USE);
        }
    }

}
```

#### 新增异常

```java
public ModelAndView resolveLoginAcctAlreadyInUseException(
	LoginAcctAlreadyInUseException exception,
	HttpServletRequest request,
	HttpServletResponse response
) throws IOException {
    // 只是指定当前异常对应的页面即可
    String viewName = "admin-add";
    return commonResolveException(exception, request, response, viewName);
}
```



## == 删 ==

## == 修 ==

## 更新管理员信息 

## == 查 == 

## 关键词查询 

### 前端

#### 页面

```jsp
<div class="panel-body">
    <form action="admin/get/page.html" method="post" class="form-inline" role="form" style="float: left;">
        <div class="form-group has-feedback">
            <div class="input-group">
                <div class="input-group-addon">查询条件</div>
                <input name="keyword" class="form-control has-success" type="text"
                       placeholder="请输入查询条件">
            </div>
        </div>
        <button type="submit" class="btn btn-warning">
            <i class="glyphicon glyphicon-search"></i> 查询
        </button>
    </form>
```

#### 翻页保持

```jsp
window.location.href = "admin/page.html?pageNum="+pageNum+"&keyword=${param.keyword}";
```





### 后端

```java
后端还是 分页的逻辑，是不用变化的
    因为分页的展示里面，就包含有 关键词查询
```



## 