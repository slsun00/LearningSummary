## api

```java
介绍
    最好直接将其在 controller 层，再添加一个 admin 文件夹，用来专门放置 api 
```

## == 分页 ==

## 讲师分页

### 后端



#### controller

```java
@ApiOperation("分页讲师列表")
@GetMapping("list/{page}/{limit}")  // 注意这个 url 是怎么写的
public R listPage(@ApiParam(value = "当前页码", required = true) @PathVariable Long page,
                  @ApiParam(value = "每页记录数", required = true) @PathVariable Long limit){

    Page<Teacher> pageParam = new Page<>(page, limit);
    IPage<Teacher> pageModel = teacherService.page(pageParam);
    List<Teacher> records = pageModel.getRecords();
    long total = pageModel.getTotal();
    return  R.ok().data("total", total).data("rows", records);
}
```



### 前端

#### api

```js
// src/api/teacher.js
pageList(page, limit, searchObj) {
    return request({
        // 注意这个是反引号，是利用 路径进行查询的
        url: `/admin/edu/teacher/list/${page}/${limit}`,
        method: 'get',
        params: searchObj
    })
}
```

#### 页面组件html

```html
<!-- 
	分页组件
	table组件下面添加分页组件
-->
<el-pagination
  :current-page="page"
  :total="total"
  :page-size="limit"
  :page-sizes="[5, 10, 20, 30, 40, 50, 100]"
  style="padding: 30px 0; text-align: center;"
  layout="total, sizes, prev, pager, next, jumper"
/>



<!--
	查询表单
	在table组件上面添加查询表单
	fetchData() { teacherApi.pageList....}
	
      <el-form-item>
        <el-button type="primary" icon="el-icon-search" @click="fetchData()">查询</el-button>
        <el-button type="default" @click="resetData()">清空</el-button>
      </el-form-item>
-->
<!--查询表单-->
<el-form :inline="true">
    <el-form-item>
        <el-input v-model="searchObj.name" placeholder="讲师"/>
    </el-form-item>

    <el-form-item>
        <el-select v-model="searchObj.level" clearable placeholder="头衔">
            <el-option value="1" label="高级讲师"/>
            <el-option value="2" label="首席讲师"/>
        </el-select>
    </el-form-item>

    <el-form-item label="入驻时间">
        <el-date-picker
                        v-model="searchObj.joinDateBegin"
                        placeholder="开始时间"
                        value-format="yyyy-MM-dd" />
    </el-form-item>
    <el-form-item label="-">
        <el-date-picker
                        v-model="searchObj.joinDateEnd"
                        placeholder="结束时间"
                        value-format="yyyy-MM-dd" />
    </el-form-item>
    <el-form-item>
        <el-button type="primary" icon="el-icon-search" @click="fetchData()">查询</el-button>
        <el-button type="default" @click="resetData()">清空</el-button>
    </el-form-item>
</el-form>
```



#### 页面组件 js

```js
// src/views/teacher/list.vue

data() {// 定义数据
    return {
        list: null, // 数据列表
        total: 0, // 总记录数
        page: 1, // 页码
        limit: 10, // 每页记录数
        searchObj: {}// 查询条件
    }
    
fetchData() {
    // 调用api
    teacherApi.pageList(this.page, this.limit, this.searchObj).then(response => {
        this.list = response.data.rows
        this.total = response.data.total
    })
}    
```

#### 每页条数

```java
// <el-pagination>组件注册事件
@size-change="changePageSize"
    
// 下部脚本
// 每页记录数改变，size：回调参数，表示当前选中的“每页条数”
changePageSize(size) {
    this.limit = size
    this.fetchData()
}    
```

#### 翻页

```java
// 为<el-pagination>组件注册事件
@current-change="changeCurrentPage"

// 定义事件脚本
// 改变页码，page：回调参数，表示当前选中的“页码”
changeCurrentPage(page) {
    this.page = page
    this.fetchData()
},      
```

#### 序列号

```html
<el-table-column
  label="#"
  width="50">
  <template slot-scope="scope">
    {{ (page - 1) * limit + scope.$index + 1 }}
  </template>
</el-table-column>
```





## == 数据维护 ==

## == 增 ==

## 新增讲师

### 后端

#### 自动填充字段

```java
package com.atguigu.guli.service.base.handler;

// 创建自动填充处理类
@Component
public class CommonMetaObjectHandler implements MetaObjectHandler {

    @Override
    public void insertFill(MetaObject metaObject) {
        this.setFieldValByName("gmtCreate", new Date(), metaObject);
        this.setFieldValByName("gmtModified", new Date(), metaObject);
    }

    @Override
    public void updateFill(MetaObject metaObject) {
        this.setFieldValByName("gmtModified", new Date(), metaObject);
    }
}
```

#### controller

```java
@ApiOperation("新增讲师")
@PostMapping("save")
public R save(@ApiParam(value = "讲师对象", required = true) @RequestBody Teacher teacher){
    boolean result = teacherService.save(teacher);
    if (result) {
        return R.ok().message("保存成功");
    } else {
        return R.error().message("保存失败");
    }
}
```





## == 删 ==

## 删除讲师

### 后端

#### controller

```java
@DeleteMapping("remove/{id}")
public boolean removeById(@PathVariable String id){
    return teacherService.removeById(id);
}

// 自动生成了 service 和 mapper 层
```

## == 改 ==

## 根据 id 更新

### 后端

#### controller

```java
@ApiOperation("更新讲师")
@PutMapping("update")
public R updateById(
    @ApiParam(value = "讲师对象", required = true) @RequestBody Teacher teacher
){
    
    boolean result = teacherService.updateById(teacher);
    if(result){
        return R.ok().message("修改成功");
    }else{
        return R.error().message("数据不存在");
    }
}
```



## 根据 id 修改

### 后端



## == 查 ==

## 条件查询

### 后端

#### 查询对象 vo

```java
package com.atguigu.guli.service.edu.entity.vo;

@Data
public class TeacherQueryVo implements Serializable {
    private static final long serialVersionUID = 1L;
    
    private String name;
    private Integer level;
    private String joinDateBegin;
    private String joinDateEnd;
}
```

#### controller

```java
@GetMapping("list/{page}/{limit}")   // 注意这个 url
public R listPage(@ApiParam(value = "当前页码", required = true) @PathVariable Long page,
                  @ApiParam(value = "每页记录数", required = true) @PathVariable Long limit,
                  @ApiParam("讲师列表查询对象") TeacherQueryVo teacherQueryVo){

    IPage<Teacher> pageModel = teacherService.selectPage(page, limit, teacherQueryVo);
    List<Teacher> records = pageModel.getRecords();
    long total = pageModel.getTotal();

    return  R.ok().data("total", total).data("rows", records);
}
```



#### service

```java
// == 接口==
package com.atguigu.guli.service.edu.service;
public interface TeacherService extends IService<Teacher> {
    IPage<Teacher> selectPage(Long page, Long limit, TeacherQueryVo teacherQueryVo);
}
// == 实现==
package com.atguigu.guli.service.edu.service.impl;

@Service
public class TeacherServiceImpl extends ServiceImpl<TeacherMapper, Teacher> implements TeacherService {

    @Override
    public IPage<Teacher> selectPage(Long page, Long limit, TeacherQueryVo teacherQueryVo) {
        
        Page<Teacher> pageParam = new Page<>(page, limit);
        
        QueryWrapper<Teacher> queryWrapper = new QueryWrapper<>();
        queryWrapper.orderByAsc("sort");

        if (teacherQueryVo == null){
            return baseMapper.selectPage(pageParam, queryWrapper);
        }

        String name = teacherQueryVo.getName();
        Integer level = teacherQueryVo.getLevel();
        String begin = teacherQueryVo.getJoinDateBegin();
        String end = teacherQueryVo.getJoinDateEnd();

        if (!StringUtils.isEmpty(name)) {
            //左%会使索引失效
            queryWrapper.likeRight("name", name);
        }

        if (level != null) {
            queryWrapper.eq("level", level);
        }

        if (!StringUtils.isEmpty(begin)) {
            queryWrapper.ge("join_date", begin);
        }

        if (!StringUtils.isEmpty(end)) {
            queryWrapper.le("join_date", end);
        }

        return baseMapper.selectPage(pageParam, queryWrapper);
    }
}
```

## 根据 id 查询

### 后端

```java
@ApiOperation("根据id获取讲师信息")
@GetMapping("get/{id}")
public R getById(@ApiParam(value = "讲师ID", required = true) @PathVariable String id){
    Teacher teacher = teacherService.getById(id);
    if(teacher != null){
        return R.ok().data("item", teacher);
    }else{
        return R.error().message("数据不存在");
    }
}
```

