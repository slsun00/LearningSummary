## 注解拦截放行

```java
介绍    
	// 该注解进行注解的是不需要登陆的拦截器直接放行
代码
    import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

/**
 * [无需登录]
 */

@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.METHOD)
public @interface NoNeedLogin {
}

```

## 拦截器

```java
介绍
	HandlerInterceptorAdapter已经过时了
    这里使用实现HandlerInterceptor接口的方式进行实现
  
// ==============================================================================    
package com.parsley.interceptor;

import com.parsley.anno.NoNeedLogin;
import com.parsley.pojo.FangDong;
import com.parsley.pojo.ZuKe;
import com.parsley.service.FangDongService;
import com.parsley.service.LoginService;
import com.parsley.service.ZuKeService;
import com.parsley.utils.TokenUtil;
import io.jsonwebtoken.Claims;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;
import org.springframework.web.method.HandlerMethod;
import org.springframework.web.servlet.HandlerInterceptor;
import org.springframework.web.servlet.ModelAndView;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@Component
public class LoginInterceptor implements HandlerInterceptor {

    @Autowired
    private FangDongService fangDongService;
    @Autowired
    private ZuKeService zuKeService;

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {

        //是不是映射到方法上
        boolean isHandlerMethod = handler instanceof HandlerMethod;
        if(!isHandlerMethod){
            System.out.println("不是方法上");
            return true;
        }
        //不需要登录的注解
        boolean isNoNeedLogin= ((HandlerMethod) handler).getMethodAnnotation(NoNeedLogin.class)!=null;
        if(isNoNeedLogin){
            System.out.println("无需登录");
            return true;
        }
        //需要登录验证
        String token = request.getHeader("Authorization");

        if(null == token){
            System.out.println("无token");
        }else {
            Claims claims = null;
            try{
                claims = TokenUtil.parseJwt(token);
            }catch (Exception e){
                System.out.println("token有误");
            }
            if (null != claims){
//                Integer id = Integer.valueOf(claims.getId());
//                String subject=claims.getSubject();
//                if(subject.equals(LoginService.TYPE_ZU_KE)){
//                    ZuKe zuKe = zuKeService.getById(id);
//                    if(zuKe!=null){
//                        request.setAttribute(LoginService.TYPE_ZU_KE,zuKe);
//                        return true;
//                    }
//                }else if (subject.equals(LoginService.TYPE_FANG_DONG)){
//                    FangDong fangDong =fangDongService.getById(id);
//                    if (fangDong!=null){
//                        request.setAttribute(LoginService.TYPE_FANG_DONG,fangDong);
//                        return true;
//                    }
//                }
//                return false;
            }
        }
        return false;
    }

    @Override
    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {

    }

    @Override
    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {

    }
}
    
```

## 配置拦截器

```java
介绍
    注意：不要添加@EnableWebMvc注解，该注解会导致MVC自动配置失效
    
// =================================================================    
代码  
    
package com.parsley.config;

import com.parsley.interceptor.LoginInterceptor;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.InterceptorRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

/**
 * Created with IntelliJ IDEA.
 *
 * @Auther: Parsley
 * @Date: 2021/02/07/20:08
 * @Description:
 */
@Configuration
public class MyWebAppConfig implements WebMvcConfigurer {

    @Autowired
    private LoginInterceptor loginInterceptor;

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(loginInterceptor)
            .addPathPatterns("/**");   // 拦截
    }
}
    
```

